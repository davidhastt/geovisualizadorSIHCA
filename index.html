<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SIHCA</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body {
      margin: 0;
      height: 100%;
    }

    #map {
      position: absolute;
      top: 56px; /* Altura del navbar */
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 0;
    }

    .sidebar {
      position: absolute;
      top: 56px;
      left: 0;
      height: calc(100% - 56px);
      width: 300px;
      background-color: #f8f9fa;
      border-right: 1px solid #ccc;
      padding: 1rem;
      overflow-y: auto;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    .sidebar.show {
      transform: translateX(0);
    }

    /*Ubicacion del control de zoom*/
    .leaflet-control-zoom {
      bottom: 30px !important; /* Ajusta este valor según lo que necesites */
      right: 0px !important;
    }


    /* Geolocalizacion ubicada arriba del control de zoom */
    #locate-btn {
      position: absolute;
      bottom: 130px; /* justo arriba del control de zoom */
      right: 10px;
      z-index: 1000;
    }

    #locate-btn a {
      display: block;
      width: 30px;
      height: 30px;
      line-height: 30px;
      text-align: center;
      background: white;
      color: black;
      text-decoration: none;
      font-size: 18px;
      border-radius: 4px;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
    }


    /* Estilo de la barra inferior */
    .bottom-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 200px;
      background-color: #f8f9fa;
      border-top: 1px solid #ccc;
      box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
      transform: translateY(100%);
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    /* Mostrar la barra */
    .bottom-bar.show {
      transform: translateY(0);
    }    

    /*Galeria de imagenes dentro del panel inferior*/
    .bottom-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 250px; /* Ajusta a tu gusto */
      background-color: #f8f9fa;
      border-top: 1px solid #ccc;
      transform: translateY(100%);
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    .bottom-bar.show {
      transform: translateY(0);
    }

    .gallery-img {
      height: 100px;
      object-fit: cover;
      border-radius: 5px;
      max-width: calc(33% - 10px); /* 3 imágenes por fila aprox. */
    }


    /* Simbologia del panel lateral    */
    .legend-color {
      width: 20px;
      height: 20px;
      border: 1px solid #000;
      border-radius: 2px;
    }
    /*formato para los iconos de los rasgos */
    .legend-icon {
      width: 20px;
      height: 20px;
      object-fit: contain;
    }


  </style>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="config.js"></script>  
</head>
<body>
  <!-- Navbar fijo -->
  <nav class="navbar navbar-dark bg-primary fixed-top">
    <div class="container-fluid">
      <button id="toggleSidebar" class="btn btn-outline-light btn-sm me-2">☰</button>
      <div id="corte"></div>      
      <a class="navbar-brand" href="#">INEGI SIHCA</a>
    </div>
  </nav>

  <!-- Sidebar superpuesta -->
  <div id="sidebar" class="sidebar">             
      <ul class="nav nav-tabs" id="sidebarTabs" role="tablist">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" href="#tab1">Capas</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" href="#tab2">Hechos</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" href="#tab3">Reseña</button></li>
      </ul>


      <div class="tab-content mt-3">
        <div class="tab-pane fade show active" id="tab1"> 

          <div id="simbologiaBase">
          <img src="./img/logo.png" class="rounded mx-auto d-block" width="100px" alt="No se encontro la imagen">
          <br>
          <h6>Bienvenido</h6>
          <p>Para empezar elije un año para mostrar las capas</p>
          <button type="button" class="btn btn-primary" onclick="document.getElementById('bottomBar').classList.add('show');">Ver años disponibles</button>
          </div>

          <div id="simbologiaRasgos"></div>

        </div>

        <div class="tab-pane fade" id="tab2"> 
          <div id="nom_rasgo"></div>
          <div id="acontecimientos">            
            <p>Esta sección se llenara despues de que elijas un rasgo para mostar sus acontecimientos</p>            
          </div>

        </div>

        <div class="tab-pane fade" id="tab3"> 

<h3>RESEÑA HISTÓRICA DE LA CIUDAD DE TOLUCA DE LERDO</h3>
<h4>ORÍGENES</h4>
<p>Se funda en el reinado de Xólotl, después del año 1120 con el nombre de Tollocan. También existe la tesis de que se establece en tiempos más remotos, como lo expone el maestro José García Payón: los Matlatzincas llegaron al Valle en el siglo VII y fundan Toluca y otros pueblos a los márgenes del Río Xihualtenco, hoy Verdiguel.</p>

<h4>ÉPOCA COLONIAL</h4>
<p>En 1521 arriban los españoles encabezados por Gonzalo de Sandoval al Valle de Toluca a la ciudad, la destruye casi totalmente, y establece el 19 de marzo de 1521 San José de Toluca.


El 6 de julio de 1529 Carlos V otorga a Cortes el título de Marqués del Valle de Oaxaca y la posesión de muchos territorios con sus habitantes, entre los que se encuentran el Valle del Matlatzinco y la Villa de Toluca.

Los frailes franciscanos llegan a Toluca en 1525 e inician la evangelización de los pueblos del Matlatzinco.

El desarrollo de las actividades económicas en la región se apoya en la encomienda, las comunidades indias, las estancias de ganado y la pequeña propiedad plebeya, prevaleciendo el cultivo del maíz como la base de la subsistencia, además de que se atiende el mercado de la capital del reino; también se implementa la crianza de ganado en el Valle de Toluca, lo que se origina la industria de embutidos; también se extiende el cultivo de trigo, con lo cual el valle se convierte en una zona agrícola y ganadera de importancia; en esta época se desarrolla y consolida la industria de la curtiduría y la fabricación de jabones, así como los obrajes o industrias textiles.

De esta época datan los principales templos religiosos establecidos en la ciudad, que además funcionan como puntos de congregación de la población indígena a partir de los cuales surgen los barrios y se facilita el control y la evangelización.

En 1725, de acuerdo a la Matrícula de Casas de San José de Toluca, cuenta con 523 viviendas con solares identificadas con su ubicación y propietario, además se compone de seis calles, trece callejones, un barrio y seis conventos.

En las afueras se encuentran los barrios de San Miguel, Santa Clara, San Bernardino, San Sebastián, San Diego, San Juan Bautista y Santa Bárbara; además de los pueblos de Santa Ana, Huitzilan, Tlacopan y Miltepec.</p>


<h5>ÉPOCA INDEPENDIENTE</h5>
<p>Al decretarse la erección del Estado de México el 2 de marzo de 1824, se establece que sigan funcionando los ayuntamientos, por lo que Toluca inicia su existencia jurídica como municipio del nuevo estado.

Una limitante al crecimiento de la ciudad en la primera mitad del siglo XIX la constituye la disponibilidad de agua, razón por la cual la construcción de viviendas se realiza sobre las cañerías que conducen el líquido a los conventos de San Francisco y El Carmen o cercanas a las pilas, es por ello que la zona sur de la ciudad se fraccionó más lentamente.

El hecho político más trascendente para la ciudad en esta época es el generado por la emisión de los decretos 126 y 130 del 5 y 12 de julio de 1830 respectivamente, que declaran a Toluca sede de los poderes del Estado de México.

Ante esta decisión, las autoridades locales y los habitantes de la ciudad se encargan de acelerar la transformación de Toluca, y que se inicia la edificación de varias obras, entre ellas los Portales, cuya primera etapa se construye entre 1832 y 1836, esta obra sirve para el establecimiento de comercios, casas habitación y oficinas públicas.

Mención especial merece la Compañía Cervecera de Toluca y México fundada por Santiago Graf en 1865 con capital alemán y la inauguración de la ruta del Ferrocarril México - Toluca el 5 de mayo de 1882.

La vía México - Morelia, que atraviesa la ciudad por lo que actualmente es la avenida Hidalgo, genera una gran dinámica, así como el establecimiento de negocios y casas habitación a lo largo de este eje en dirección oriente-poniente.

La zona de la estación del Ferrocarril México - Toluca, que se convierte en un lugar apropiado para el establecimiento de bodegas, comercios e industrias, por lo que la ciudad intensifica su crecimiento en dirección oriente.</p>


<h6>ÉPOCA CONTEMPORANEA</h6>
<p>Toluca empieza a modernizarse durante la época de los 30, en este periodo se concluye el Mercado 16 de Septiembre, se amplía el servicio de agua potable y drenaje, se arreglan las calles y se construye el primer aeropuerto; también se construyen grandes centros escolares de nivel básico.

En 1940 la ciudad registra 43 429 habitantes.

En 1943 el Instituto Científico y Literario adquiere su autonomía y el 17 de marzo de 1956 se transforma en la Universidad Autónoma del Estado de México.

Para los años 60 la ciudad cuenta con 77 124 habitantes y ya se encuentran instaladas en la Zona Industrial varias empresas, como son: Compañía Nestlé, instalada en 1961, Compañía Industrial de Abrasivos, en 1962; Automex, en 1964; Fábricas Monterrey en 1968, y la Cervecería Cuauhtémoc, en 1969.

Destaca el inicio de los servicios médicos del Instituto Mexicano del Seguro Social, inaugurada en 1964; los hospitales para la Mujer y para el Niño, en 1967 y 1968, respectivamente y la construcción del edificio de la Policlínica en 1969.

En 1970 la población de Toluca asciende a 114 079 pobladores.

Todas las obras de equipamiento que se han edificado en la ciudad, la convierten en un importante centro de servicios, lo que se refleja en un aumento de su población a 327 865 habitantes para el año de 1990, este incremento se refleja en la integración a la ciudad de otras localidades periféricas y la conurbación con cinco municipios.</p>







          <!--
          <h6>Elije la entidad</h6>
          <div id="entidadesDIV"></div>
          <div id="capitalesDIV"></div>
          -->
          <div id="botonReestablecer"></div>
        </div>
      </div> 
  </div>
    


  <!-- Mapa -->
  <div id="map"></div>

  <!-- Botón personalizado -->
  <div id="locate-btn" class="leaflet-bar leaflet-control" title="Mi ubicación">
    <a href="#" role="button">📍</a>
  </div>

  <!-- Botón flotante para mostrar/ocultar la barra -->
  <button id="toggleBottomBar" class="btn btn-primary rounded-pill position-absolute" style="bottom: 20px; right: 20px; z-index:1001;">
    ⬆ Cortes
  </button>


  <!-- Barra inferior oculta inicialmente -->

<div id="bottomBar" class="bottom-bar">
  <div class="p-2 h-100 overflow-auto">
    <p>Para mostrar capas elije un corte</p>
    <div class="d-flex flex-wrap gap-2 justify-content-center">
      <div id="cutsCards">
        <div class="spinner-grow text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <div class="spinner-grow text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div> 
        <div class="spinner-grow text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>  
      </div>
    </div>
  </div>
</div>
</body>

<!-- Modal con carrusel -->
<div class="modal fade" id="carouselModal" tabindex="-1" aria-labelledby="carouselModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="carouselModalLabel">Galería de Imágenes</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body" id="modalic">



      </div>
    </div>
  </div>
</div>





  <!-- Scripts -->
  <script>

  // Inicializar el mapa SIN el control de zoom
    const map = L.map('map', {
    center: [23.691111538819403, -102.32562360568357],
    zoom: 6,
    zoomControl: false // Desactiva el control por defecto (que va arriba a la izquierda)
    });

    // Añadir el control de zoom en la esquina inferior derecha
    L.control.zoom({ position: 'bottomright' }).addTo(map);
 
    // Capa base vacía (fondo blanco)
    const blanco = L.tileLayer('', {
      attribution: ''
    }).addTo(map);

    const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    const esri = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
      attribution: 'Tiles &copy; Esri'
    });

    
    // Establecer fondo blanco mediante estilo directo
    document.getElementById('map').style.backgroundColor = 'white';    
    
    //Agregamos las capas base
    L.control.layers({ 'Fondo blanco': blanco, 'OpenStreetMap': osm, 'Satélite Esri': esri }).addTo(map);


    // Toggle sidebar
    const toggleBtnSB = document.getElementById('toggleSidebar');
    const sidebar = document.getElementById('sidebar');

    toggleBtnSB.addEventListener('click', () => {
      sidebar.classList.toggle('show');
    });

    //document.getElementById('sidebar').classList.add('show'); 

    // JS para controlar visibilidad del sidebar 
    const bottomBar = document.getElementById('bottomBar');
    const toggleBtn2 = document.getElementById('toggleBottomBar');

    toggleBtn2.addEventListener('click', () => {  
      bottomBar.classList.toggle('show');
    });

    //document.getElementById('bottomBar').classList.add('show'); 
    
    // Función para ubicar al usuario
    document.getElementById('locate-btn').addEventListener('click', function (e) {
      e.preventDefault();
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          function (position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            map.setView([lat, lng], 16); // acercamos más
            L.marker([lat, lng]).addTo(map)
              .bindPopup('¡Esta es tu ubicación aproximada!').openPopup();
          },
          function () {
            alert('No pudimos obtener tu ubicación 😕');
          }
        );
      } else {
        alert('Tu navegador no soporta geolocalización');
      }
    });


//llenaCBXentidades();
//llenaCBXcapitales();
//loadCapitals();
//control de capas
// Objeto para guardar todas tus capas
const capas = {};



loadEntidad(15);
loadCapital(15);

async function showAcontecimientos(rasgo){
const url = `http://${host}:${port}/spatyal/getAcontecimientosByRasgo/${rasgo.id_rasgo}`;
  //console.log(url);  
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Response status: ${response.status}`);
      console.log("Error");
    }else{
      //Primero cambiamos el titulo
      document.getElementById("nom_rasgo").innerHTML=
              `
              <h5 class="card-title">${rasgo.nom_rasgo}</h5>
              <h6 class="card-subtitle mb-2 text-body-secondary">${rasgo.nom_concepto}</h6>
              `;

      //console.log(rasgo);

      let acontecimientos = await response.json()
      let acontsArr= acontecimientos.Respuesta;
      htmlAconts="";
      acontsArr.forEach(acontecimiento => {
      //const fechaCompleta = "1989-11-17T06:00:00.000Z";
      acontecimiento.fecha = new Date(acontecimiento.fecha).toISOString().split('T')[0];
      
      //let fecha=acontecimiento.fecha;
      fecha = new Date(acontecimiento.fecha);
      const dia = fecha.getDate();
      const mes = fecha.getMonth() + 1; 
      const anio = fecha.getFullYear();
      acontecimiento.fecha=`${dia}/${mes}/${anio}`

      htmlAconts+=
      `
        <div class="card" style="width: 16rem;">
          <div class="card-body">
            <h5 class="card-title">${acontecimiento.fecha}</h5>              
            <p class="card-text">${acontecimiento.acontecimiento}</p>
            
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#carouselModal" onclick="showEditarModal(${acontecimiento.id_acontecimiento}, '${acontecimiento.fecha}', '${acontecimiento.acontecimiento}')">Editar</button>



          </div>
        </div>        
      `;
    });
    document.getElementById("acontecimientos").innerHTML=htmlAconts;
      




    



    }
  } catch (error) {
    console.error(error.message);    
  } 


}


function showEditarModal(id_acontecimiento, fecha, acontecimiento){
  
  document.getElementById("carouselModalLabel").innerHTML=`<h5 class="modal-title" id="carouselModalLabel">Editar acontecimiento</h5>`;
  const token = localStorage.getItem("token");
  if (token){
      editarHTML=`
      <div class="container mt-5">
        <div class="row justify-content-center">
          <div class="col-md-6">
            <div class="card shadow">
              <div class="card-header bg-primary text-white text-center">
                <h4>Editar acontecimiento ${id_acontecimiento}</h4>
              </div>
              <div class="card-body">
                <form action="procesar.php" method="POST">
                  <div class="mb-3">
                    <label for="fecha" class="form-label">Fecha</label>
                    <input type="date" id="fecha" name="fecha" class="form-control" required value="${fecha}">
                  </div>
                  <div class="mb-3">
                    <label for="acontecimiento" class="form-label">Acontecimiento</label>
                    <input type="text" id="acontecimiento" name="acontecimiento" class="form-control" placeholder="Describe el acontecimiento" required value="${acontecimiento}">
                  </div>
                  <button type="submit" class="btn btn-success w-100">Guardar</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
      `; 
      document.getElementById("modalic").innerHTML=editarHTML;     
  }else{
      editarHTML=`
      <div class="container mt-5">
        <div class="row justify-content-center">
          <div class="col-md-6">
            <div class="card shadow">
              <div class="card-header bg-primary text-white text-center">
                <h4>Editar acontecimiento</h4>
              </div>
              <div class="card-body">
                <form action="procesar.php" method="POST">
                  <div class="mb-3">
                    <label for="fecha" class="form-label">Fecha</label>
                    <input type="date" id="fecha" name="fecha" class="form-control" required>
                  </div>
                  <div class="mb-3">
                    <label for="acontecimiento" class="form-label">Acontecimiento</label>
                    <input type="text" id="acontecimiento" name="acontecimiento" class="form-control" placeholder="Describe el acontecimiento" required>
                  </div>
                  <button type="submit" class="btn btn-success w-100">Guardar</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
      `;    
    loginHTML=`
    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-md-6">
          <div class="card p-4 shadow-sm">
            <h3 class="card-title mb-4 text-center">Inicio de sesión</h3>
            <form id="loginForm">
              <div class="mb-3">
                <label for="email" class="form-label">Correo electrónico</label>
                <input type="email" class="form-control" id="email" required />
              </div>
              <div class="mb-3">
                <label for="password" class="form-label">Contraseña</label>
                <input type="password" class="form-control" id="password" required />
              </div>
              <button type="submit" class="btn btn-primary w-100">Ingresar</button>
              <div id="message" class="mt-3 text-center"></div>
            </form>
          </div>
        </div>
      </div>
    </div>    
    `;

    document.getElementById("modalic").innerHTML=loginHTML;
    document.getElementById("loginForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const correo = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      try {
        const response = await fetch(`http://${host}:${port}/personas/login`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ correo, password }),
        });

        const data = await response.json();
        const messageDiv = document.getElementById("message");

        if (data.status === 200) {
          localStorage.setItem("token", data.JWT); // Guarda el token
          messageDiv.innerHTML = `
          <span class="text-success">
          ${data.message}
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando...</span>
          </div>
          </span>`;
          setTimeout(() => {
            
            document.getElementById("modalic").innerHTML=editarHTML;


          }, 2000); // 10,000 milisegundos = 10 segundos

        } else {
          messageDiv.innerHTML = `<span class="text-danger">Error: ${data.message}</span>`;
        }
      } catch (error) {
        console.error("Error en login", error);
        document.getElementById("message").innerHTML = `<span class="text-danger">Problema en el servidor</span>`;
      }
    });

  }











}




function showTab(id_tab, rasgo){
  //Primero abrimos el panel lateral
  document.getElementById('sidebar').classList.add('show'); 
  //Declaracion de constante para mostrar y ocultar el tab2

  if (id_tab==2){// mostrar acontecmiento
    const tab = new bootstrap.Tab(document.querySelector('[href="#tab2"]'));  
    tab.show();    
    showAcontecimientos(rasgo);
   }else{
    const tab = new bootstrap.Tab(document.querySelector('[href="#tab1"]'));  
    tab.show();
   }
   
   

}


function obtenerURLicono(id_concepto) {
    let iconoUrl="";

    switch (id_concepto) {
      case 1: //alameda
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/4591/4591794.png';        
        break;
      case 2://archivo
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/6100/6100580.png';
        break;
      case 3://biblioteca
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/3068/3068327.png';
        break;
      case 4:// iglesia
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/615/615955.png';
        break;
      case 5://carcel
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/1022/1022331.png';
        break;
      case 6:// casa de diligencias
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/8741/8741291.png';
        break;
      case 7: //cementerio
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/5880/5880107.png';
        break;
      case 8: //terminal de autobuses
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/11649/11649243.png';
        break;
      case 9:// bomberos
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/864/864564.png';
        break;
      case 10:// centro de cultura
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/10987/10987278.png';
        break;
      case 11: //cine
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/10351/10351880.png';
        break;  
      case 12://comercio
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/7314/7314483.png';
        break;
      case 13://convento
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/9836/9836113.png';
        break;
      case 14://Escuela
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/167/167707.png';
        break;
      case 15://estacion de ferrocarril
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/15862/15862868.png';
        break;
      case 16://estadio
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/919/919380.png';
        break;
      case 17://guarderia
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/4506/4506230.png';
        break;
      case 18://Hospital
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/2309/2309962.png';
        break;
      case 19://hotel
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/3009/3009489.png';
        break;
      case 20://industria alimentaria
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/3690/3690289.png';
        break; 
      case 21://industria del cuero
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/14849/14849780.png';
        break;                                                                                
      case 22://industria del tabaco
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/8997/8997260.png';
        break;
      case 23://industria editorial
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/13516/13516733.png';
        break;
      case 24://industria quimica
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/11873/11873377.png';
        break;
      case 25://industria textil
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/8604/8604604.png';
        break;
      case 26://industria de las bebidas
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/8604/8604608.png';
        break;
      case 27://lavaderos publicos
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/7212/7212512.png';
        break;
      case 28://maquinaria y equipo
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/16355/16355663.png';
        break;
      case 29://mercado
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/17024/17024174.png';
        break;
      case 30://Monte de piedad
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/16057/16057747.png';
        break;
      case 31:// Monumento
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/25/25889.png';
        break;
      case 32://Museo
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/3936/3936816.png';
        break;
      case 33://oficina de correo
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/831/831499.png';
        break;
      case 34://oficina telegrafica
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/3020/3020787.png';
        break;
      case 35://palacio municipal
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/9417/9417537.png';
        break;
      case 36://palacio de gobierno
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/9418/9418169.png';
        break;
      case 37://palacio de justicia
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/16484/16484256.png';
        break;
      case 38://palacio municipal
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/5309/5309265.png';
        break;
      case 39://plaza
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/4506/4506403.png';
        break;
      case 40://portal
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/4324/4324013.png';
        break;
      case 41://rastro
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/15833/15833082.png';
        break;
      case 42://sala de concierto
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/10061/10061682.png';
        break;
      case 43://seminario
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/1526/1526970.png';
        break;
      case 44://sitio de interes
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/3967/3967155.png';
        break;
      case 45://teatro
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/2787/2787884.png';
        break;
      case 46://templo
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/4050/4050101.png';
        break;
      case 47://tribunal de menores
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/5493/5493436.png';
        break;
      case 48://unidad de urgencias
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/3974/3974881.png';
        break;        
      case 49://unidad deportiva
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/4163/4163684.png';
        break;
      case 50://unidad medica
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/8519/8519905.png';
        break;
      case 51://zona industrial
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/1037/1037503.png';
        break;                        
      default:
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/11316/11316431.png';
    }

    return iconoUrl;
  }



  function obtenerIcono(id_concepto) {
    let iconoUrl="";

    switch (id_concepto) {
      case 1: //alameda
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/4591/4591794.png';        
        break;
      case 2://archivo
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/6100/6100580.png';
        break;
      case 3://biblioteca
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/3068/3068327.png';
        break;
      case 4:// iglesia
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/615/615955.png';
        break;
      case 5://carcel
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/1022/1022331.png';
        break;
      case 6:// casa de diligencias
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/8741/8741291.png';
        break;
      case 7: //cementerio
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/5880/5880107.png';
        break;
      case 8: //terminal de autobuses
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/11649/11649243.png';
        break;
      case 9:// bomberos
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/864/864564.png';
        break;
      case 10:// centro de cultura
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/10987/10987278.png';
        break;
      case 11: //cine
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/10351/10351880.png';
        break;  
      case 12://comercio
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/7314/7314483.png';
        break;
      case 13://convento
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/9836/9836113.png';
        break;
      case 14://Escuela
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/167/167707.png';
        break;
      case 15://estacion de ferrocarril
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/15862/15862868.png';
        break;
      case 16://estadio
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/919/919380.png';
        break;
      case 17://guarderia
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/4506/4506230.png';
        break;
      case 18://Hospital
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/2309/2309962.png';
        break;
      case 19://hotel
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/3009/3009489.png';
        break;
      case 20://industria alimentaria
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/3690/3690289.png';
        break; 
      case 21://industria del cuero
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/14849/14849780.png';
        break;                                                                                
      case 22://industria del tabaco
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/8997/8997260.png';
        break;
      case 23://industria editorial
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/13516/13516733.png';
        break;
      case 24://industria quimica
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/11873/11873377.png';
        break;
      case 25://industria textil
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/8604/8604604.png';
        break;
      case 26://industria de las bebidas
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/8604/8604608.png';
        break;
      case 27://lavaderos publicos
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/7212/7212512.png';
        break;
      case 28://maquinaria y equipo
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/16355/16355663.png';
        break;
      case 29://mercado
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/17024/17024174.png';
        break;
      case 30://Monte de piedad
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/16057/16057747.png';
        break;
      case 31:// Monumento
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/25/25889.png';
        break;
      case 32://Museo
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/3936/3936816.png';
        break;
      case 33://oficina de correo
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/831/831499.png';
        break;
      case 34://oficina telegrafica
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/3020/3020787.png';
        break;
      case 35://palacio municipal
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/9417/9417537.png';
        break;
      case 36://palacio de gobierno
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/9418/9418169.png';
        break;
      case 37://palacio de justicia
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/16484/16484256.png';
        break;
      case 38://palacio municipal
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/5309/5309265.png';
        break;
      case 39://plaza
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/4506/4506403.png';
        break;
      case 40://portal
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/4324/4324013.png';
        break;
      case 41://rastro
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/15833/15833082.png';
        break;
      case 42://sala de concierto
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/10061/10061682.png';
        break;
      case 43://seminario
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/1526/1526970.png';
        break;
      case 44://sitio de interes
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/3967/3967155.png';
        break;
      case 45://teatro
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/2787/2787884.png';
        break;
      case 46://templo
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/4050/4050101.png';
        break;
      case 47://tribunal de menores
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/5493/5493436.png';
        break;
      case 48://unidad de urgencias
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/3974/3974881.png';
        break;        
      case 49://unidad deportiva
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/4163/4163684.png';
        break;
      case 50://unidad medica
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/8519/8519905.png';
        break;
      case 51://zona industrial
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/1037/1037503.png';
        break;                        
      default:
        iconoUrl = 'https://cdn-icons-png.flaticon.com/128/11316/11316431.png';
    }

    return L.icon({
      iconUrl: iconoUrl,
      iconSize: [32, 32],
      iconAnchor: [16, 32],
      popupAnchor: [0, -32]
    });
  }

function loadSimbologiaBase(){

//primero limpiaños
document.getElementById('simbologiaBase').innerHTML="";
document.getElementById('simbologiaBase').innerHTML=`
        <h6>🗂️ Simbología</h6>

        <div class="legend-item d-flex align-items-center mb-2">
          <input type="checkbox" checked class="form-check-input me-2" onchange="toggleLayer('rios')">
          <div class="legend-color" style="background-color: blue;"></div>
          <span class="ms-2">Rios</span>
        </div>
        
        <div class="legend-item d-flex align-items-center mb-2">
          <input type="checkbox" class="form-check-input me-2" checked onchange="toggleLayer('cl')">
          <div class="legend-color" style="background-color: #c14a31;"></div>
          <span class="ms-2">Cotas</span>
        </div>         


        <div class="legend-item d-flex align-items-center mb-2">
          <input type="checkbox" class="form-check-input me-2" checked onchange="toggleLayer('pl')">
          <div class="legend-color" style="background-color: #cd2743;"></div>
          <span class="ms-2">Poligono de localidad</span>
        </div>

        <div class="legend-item d-flex align-items-center mb-2">
          <input type="checkbox" class="form-check-input me-2" checked onchange="toggleLayer('manzanas')">
          <div class="legend-color" style="background-color: #f4ea0c;"></div>
          <span class="ms-2">Manzanas</span>
        </div>


        <div class="legend-item d-flex align-items-center mb-2">
          <input type="checkbox" class="form-check-input me-2" checked onchange="toggleLayer('vialidades')">
          <div class="legend-color" style="background-color: #69685f;"></div>
          <span class="ms-2">Vialidades</span>
        </div>
`;
}





function loadLayers(id_anio, cve_agee){  
  document.getElementById('sidebar').classList.add('show');
  showTab(1, {});
  borrarContenidoMapa();
  loadManzanas(id_anio, cve_agee);
  loadRios(cve_agee);
  loadCL(cve_agee);
  loadPL(id_anio, cve_agee);
  loadVialidades(id_anio, cve_agee);
  loadRasgos(id_anio, cve_agee);
  loadSimbologiaBase();

  switch (id_anio) {
    case 1:
      anio=1725;
      break;
    case 2:
      anio=1817;
      break;
    case 3:
      anio=1854;
      break;
    case 4:
      anio=1894;
      break;
    case 5:
      anio=1947;
      break;
    case 6:
      anio=1964;
      break;
    case 7:
      anio=1982;
      break;
    case 8:
      anio=1993;
      break;
    case 9:
      anio=2000;
      break;
    case 10:
      anio=2007;
      break;
    case 11:
      anio=2010;
      break;
    case 12:
      anio=2018;
      break;                                    
    default:
      anio="Error";
      break;
  }
    
  document.getElementById("corte").innerHTML=`<a class="navbar-brand">${anio}</a>`;
}

function agregarSimbologiaXconcepto(id_concepto, nom_cocepto) {
    const leyenda = document.getElementById('simbologiaRasgos');
    const item = document.createElement('div');
    //item.className = 'legend-item d-flex align-items-center mb-2';
    const iconURL=obtenerURLicono(id_concepto);
    item.innerHTML = `
          <div class="legend-item d-flex align-items-center mb-2">
            <input type="checkbox" class="form-check-input me-2" checked onchange="toggleLayer('${nom_cocepto}')">
            <img src="${iconURL}" alt="No se encontro" class="legend-icon">
            <span class="ms-2">${nom_cocepto}</span>
          </div>
    `;
    leyenda.appendChild(item);
}



async function loadRasgos(id_anio, id_capital){
  const url = `http://${host}:${port}/spatyal/getConceptosCutAndEnt/${id_capital}/${id_anio}`;
  //console.log(url);
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Response status: ${response.status}`);
      console.log("Error");
    }else{
      let conceptosArr = await response.json();
      conceptosArr=conceptosArr.Respuesta;
      //console.log(conceptosArr);
      //primero borramos la simbologia
      document.getElementById("simbologiaRasgos").innerHTML="";
      conceptosArr.forEach(concepto=>{ //ahora vamos a lanzar una peticion http por cada concepto
        loadGeoJSONbyConceptoAndCut(concepto.id_concepto, concepto.nom_concepto, id_anio, id_capital);
        //Ahora tenemos que agregar su simbologia respectiva
        agregarSimbologiaXconcepto(concepto.id_concepto, concepto.nom_concepto);
      })



    }
  } catch (error) {
    console.error(error.message);
  } 

}


async function loadGeoJSONbyConceptoAndCut(id_concepto, nom_concepto, id_anio, id_capital){
  const url = `http://${host}:${port}/spatyal/GetRasgosByEntAndCut/${id_capital}/${id_anio}/${id_concepto}`;
  //console.log(url);
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Response status: ${response.status}`);
      console.log("Error");
    }else{
      let rasgosArr = await response.json();
      rasgosGeoJSON=rasgosArr[0].geojson;
      //console.log(rasgosGeoJSON);
      
      
    // Cargar datos en el mapa
    const rasgosLayer=L.geoJSON(rasgosGeoJSON, {
      pointToLayer: function (feature, latlng) {
        return L.marker(latlng, {
          icon: obtenerIcono(feature.properties.id_concepto)
        });
      },
      onEachFeature: function (feature, layer) {
        layer.bindPopup(`
        <strong>${feature.properties.nom_rasgo}</strong>
        <br>${feature.properties.direccion}<br>
        <br>${feature.properties.nom_concepto}<br>
        <a href="#" onclick="showTab(2, {'id_rasgo': ${feature.properties.id_rasgo},   'nom_rasgo': '${feature.properties.nom_rasgo}',   'direccion': '${feature.properties.direccion}',  'nom_concepto': '${feature.properties.nom_concepto}'})" >Acontecimientos</a>`);
      }




    }).addTo(map);
      capas[nom_concepto] = rasgosLayer;
      //console.log(capas)      
    }
  } catch (error) {
    console.error(error.message);
  }  

}


function toggleLayer(id_layer) {
	const layer = capas[id_layer];
	if (layer && !map.hasLayer(layer)) {
		map.addLayer(layer);
	}else if (layer && map.hasLayer(layer)) {
		map.removeLayer(layer);
  }
}


async function loadRios(cve_agee){
  const url = `http://${host}:${port}/spatyal/getRiosByEnt/${cve_agee}`;
  //console.log(url);
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Response status: ${response.status}`);
      console.log("Error");
    }else{
      let riosArr = await response.json();
      riosGeoJSON=riosArr[0].geojson;
      //console.log(riosArr[0].geojson);      

      const riosLayer =L.geoJSON(riosArr[0].geojson, {
        style: {
          //color: 'red',         // Borde
          fillColor: 'blue',  // Relleno
          fillOpacity: 0.5,
          weight: 2
        }
      });

      capas["rios"] = riosLayer;
      riosLayer.addTo(map); // Agrega al mapa
      //console.log(capas);

    }
  } catch (error) {
    console.error(error.message);
  }  

}



async function loadCL(cve_agee){
  const url = `http://${host}:${port}/spatyal/getCLbyEnt/${cve_agee}`;
  //console.log(url);
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Response status: ${response.status}`);
      console.log("Error");
    }else{
      let clArr = await response.json();
      clGeoJSON=clArr[0].geojson;

      const clLayer =L.geoJSON(clArr[0].geojson, {
        style: {
          color: '#c14a31',         // Borde
          //fillColor: 'blue',  // Relleno
          fillOpacity: 0.5,
          weight: 2
        }
      });

      capas["cl"] = clLayer;
      clLayer.addTo(map); // Agrega al mapa
      //console.log(capas);

    }
  } catch (error) {
    console.error(error.message);
  }  

}



async function loadPL(id_anio, cve_agee) {
  const url = `http://${host}:${port}/spatyal/getPLbyEntAndCut/${cve_agee}/${id_anio}`;
  //console.log(url);
  
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Response status: ${response.status}`);
      console.log("Error");
    }else{
      //primero borramos lo que tiene el mapa actualmente
      //borrarContenidoMapa();
      let plJSON = await response.json();      
      plJSON=plJSON[0].geojson;
      //console.log(plJSON);      
      //const capa = L.geoJSON(plJSON).addTo(map);
      
      const plLayer =L.geoJSON(plJSON, {
        style: {
          color: '#cd2743',         // Borde
          //fillColor: 'blue',  // Relleno
          fillOpacity: 0.0,
          weight: 2
        }
      }).addTo(map);

      capas["pl"] = plLayer;
      //clLayer.addTo(map); // Agrega al mapa

      //map.fitBounds(plLayer.getBounds());
      
    }
  } catch (error) {
    console.error(error.message);    
  } 
    
}


async function loadManzanas(id_anio, cve_agee) {
  const url = `http://${host}:${port}/spatyal/GetManzanasByEntAndCut/${cve_agee}/${id_anio}`;
  //console.log(url);
  
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Response status: ${response.status}`);
      console.log("Error");
    }else{
      //primero borramos lo que tiene el mapa actualmente
      //borrarContenidoMapa();
      let manzanasJSON = await response.json();      
      manzanasJSON=manzanasJSON[0].geojson;

      const manzanasLayer =L.geoJSON(manzanasJSON, {
        style: {
          color: '#f1e9b7',         // Borde
          fillColor: '#f1e9b7',  // Relleno
          fillOpacity: 0.5,
          weight: 2
        }
      }).addTo(map);

      capas["manzanas"] = manzanasLayer;
      map.fitBounds(manzanasLayer.getBounds());
      
    }
  } catch (error) {
    console.error(error.message);    
  } 
    
}


async function loadVialidades(id_anio, cve_agee) {
  const url = `http://${host}:${port}/spatyal/GetVialidadesByEntAndCut/${cve_agee}/${id_anio}`;
  //console.log(url);
  
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Response status: ${response.status}`);
      console.log("Error");
    }else{
      //primero borramos lo que tiene el mapa actualmente
      //borrarContenidoMapa();
      let vialidadesJSON = await response.json();      
      vialidadesJSON=vialidadesJSON[0].geojson;

      const vialidadesLayer =L.geoJSON(vialidadesJSON, {
        style: {
          color: '#69685f',         // Borde
          fillColor: '#69685f',  // Relleno
          fillOpacity: 0.5,
          weight: 5
        }
      }).addTo(map);

      capas["vialidades"] = vialidadesLayer;
      
    }
  } catch (error) {
    console.error(error.message);    
  } 
    
}

async function loadCapitals(){

  const url = `http://${host}:${port}/spatyal/getCapitales`;
  //console.log(url);
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Response status: ${response.status}`);
      console.log("Error");
    }else{
      let capitalsArr = await response.json();

      capitalsArr.forEach(element=>{
          //console.log(element.capital);          
          L.marker([element.y, element.x]).addTo(map)
          .bindPopup(`<b>${element.capital}</b><br>${element.nom_agee}`);          
      });

    }
  } catch (error) {
    console.error(error.message);
  }

}

function loadGaleria(anio){
fotos={
"1725":[10,11,12,],
"1817":[10,11,12,],
"1854":[22,10,71,11,12,],
"1894":[79,19,22,68,10,71,11,12,30,75,15,],
"1947":[2,35,79,17,61,19,20,65,22,68,10,71,11,27,73,12,30,77,32,55,56,77,15,],
"1964":[2,35,36,3,17,61,19,20,41,65,22,68,9,10,49,50,71,11,73,12,30,31,77,32,55,56,77,14,34,78,15,],
"1982":[2,35,36,3,17,18,61,4,19,20,41,65,6,7,22,23,68,47,69,70,9,10,26,49,50,71,11,72,73,12,29,52,53,74,53,54,54,76,77,55,56,77,14,33,34,57,78,15,],
"1993":[2,16,35,79,36,3,17,37,18,38,61,62,4,19,20,41,64,42,43,65,6,21,7,22,23,45,67,68,46,47,69,80,70,9,24,25,10,26,49,50,71,11,8172,73,12,28,29,52,53,74,30,53,54,31,54,76,77,32,55,56,77,14,33,34,57,78,15,],
"2000":[2,16,35,36,3,17,37,18,61,62,4,19,20,41,64,65,6,21,7,22,23,45,68,46,47,69,80,70,9,24,25,10,26,49,11,72,12,29,52,30,54,31,54,32,55,56,14,33,34,57,78,15,],
"2010":[2,16,35,36,3,17,37,61,62,4,19,20,41,64,65,6,21,7,22,23,45,68,46,47,69,80,70,9,24,25,10,26,49,11,72,12,29,52,30,54,31,54,32,55,56,14,33,34,57,78,15,],
"2018":[2,16,35,36,3,17,37,18,61,62,4,19,20,41,64,65,6,21,7,22,23,45,68,46,47,69,80,70,9,24,25,10,26,49,11,72,12,29,52,30,54,31,54,32,55,56,14,33,34,57,78,15,]
}


fotosArr=fotos[anio];

let htmlGalery=`
<div id="carouselImages" class="carousel slide" data-bs-ride="carousel">
<div class="carousel-inner">`;
i=0;
fotosArr.forEach(foto=>{

    if(i==0){
      active="active";
      i=100;
    }else{
      active="";
    }

    htmlGalery+=
      `
        <div class="carousel-item ${active}">
          <img src="./img/historicas/${foto}.BMP" class="d-block w-100" alt="No se encontro ${foto}">
        </div>`; 
})
htmlGalery+=`
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselImages" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselImages" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
        </button>
  </div>
  </div>`;


document.getElementById("carouselModalLabel").innerHTML=`<h5 class="modal-title" id="carouselModalLabel">Galería de Imágenes ${anio}</h5>`

document.getElementById("modalic").innerHTML=htmlGalery;


}


async function loadCardsCuts(cve_agee){ //creo que ya no se usa esta funcion

  const url = `http://${host}:${port}/construcciones/getCortesByAGEE/${cve_agee}`;
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Response status: ${response.status}`);
      console.log("Error");
    }else{
      let cortesArr = await response.json();
      cortesArr=cortesArr.Respuesta;
      //console.log(cortesArr); 
      htmlCode="";

      if (cortesArr.length > 0){
          htmlCode+='<div class="row row-cols-1 row-cols-md-5 g-4">';
          cortesArr.forEach(element => {
            //console.log(element.cortes);
            htmlCode+=              
                '<div class="col">'+
                  '<div class="card">'+
                    '<div class="card-body">'+
                      '<h5 class="card-title">'+element.anio+'</h5>'+
                      '<p class="card-text">Click para cargar datos del año '+element.anio+'</p>'+
                      '<div class="btn-group">'+
                        '<a href="#" class="btn btn-primary active" aria-current="page" onclick="loadLayers('+element.id_anio+', '+cve_agee+')">Cargar capas</a>'+
                        '<button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#carouselModal" onclick="loadGaleria('+element.anio+')";>Galería</button>'+
                      '</div>'+
                    '</div>'+
                  '</div>'+
                '</div>'          
          });

          htmlCode+='</div>';
    }else{
            htmlCode+=
              '<div class="card text-center mb-3" style="width: 18rem;">'+
                  '<div class="card-body">'+
                    '<h5 class="card-title">Sin datos</h5>'+
                    '<p class="card-text">Sin datos</p>'+
                  '</div>'+
                '</div>';
    }
    document.getElementById("cutsCards").innerHTML=htmlCode;
      

    }
  } catch (error) {
    console.error(error.message);
  }



}


async function llenaCBXentidades() {
  const url = `http://${host}:${port}/spatyal/getNombresEntidades`;
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Response status: ${response.status}`);
      console.log("Error");
    }else{
      const entidadesJSON = await response.json();
      //console.log(entidadesJSON);      
      htmlCode=
      '<select class="form-select" aria-label="Default select example" onchange="borrarContenidoMapa(); loadCapital(this.value); loadEntidad(this.value);" id="entidadesCBX">'+
          '<option selected>Entidades</option>';
      entidadesJSON.forEach(element => {

        htmlCode+='<option value="'+element.cve_agee+'">'+element.nomgeo+'</option>';        

      });      
      
      htmlCode+='</select>';
      //console.log(htmlCode);
      document.getElementById("entidadesDIV").innerHTML=htmlCode;
      
    }
  } catch (error) {
    console.error(error.message);
  }
}



async function llenaCBXcapitales(){
  //const cve_agee=document.getElementById("entidadesCBX").value;


  const url = `http://${host}:${port}/spatyal/getCapitales`;
  //console.log(url);
  
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Response status: ${response.status}`);
      console.log("Error");
    }else{
      let capitalesJSON = await response.json();
      //console.log(municipiosJSON);
      //municipiosJSON=municipiosJSON.Respuesta[0];            
      htmlCode=
      '<h6>Elije la capital</h6>'+
      '<select class="form-select" aria-label="Default select example" id="capitalesCBX" onchange="borrarContenidoMapa(); loadCapital(this.value); loadEntidad(this.value);">'+
          '<option selected>Capitales</option>';      
      capitalesJSON.forEach(element => {
        //console.log(element.cve_agee);
        htmlCode+='<option value="'+element.cve_agee+'">'+element.capital+'</option>';        
      });      
      htmlCode+='</select>';
      //console.log(htmlCode);
      document.getElementById("capitalesDIV").innerHTML=htmlCode;          
    }

  } catch (error) {
    console.error(error.message);
    
  }

}


async function loadCapital(cve_agee) {
  const url = `http://${host}:${port}/spatyal/getCapital/${cve_agee}`;
  //console.log(url);
  
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Response status: ${response.status}`);
      console.log("Error");
    }else{
      let capitalesJSON = await response.json();
      capitalesJSON=capitalesJSON[0].geojson;      
      // extraemos cordenadas
      x= capitalesJSON.features[0].geometry.coordinates[0];
      y= capitalesJSON.features[0].geometry.coordinates[1];
      //extraemos la capital
      const capital=capitalesJSON.features[0].properties.capital;
      //extraemos  el nombre de la entidad
      const nom_agee=capitalesJSON.features[0].properties.nom_agee;      
      //console.log(nom_agee);
      let marker = L.marker([y, x]).addTo(map);
      marker.bindPopup(`<b>${capital}</b><br>${nom_agee}`).openPopup();
      //map.flyTo([y, x], 10); 
      //mostramos la barra inferior
      document.getElementById('bottomBar').classList.add('show'); 
    }
  } catch (error) {
    console.error(error.message);
    
  }
}


async function loadEntidad(cve_agee) {
  
  const url = `http://${host}:${port}/spatyal/getEntidadPolygon/${cve_agee}`;
  //console.log(url);
  
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Response status: ${response.status}`);
      console.log("Error");
    }else{
      //primero borramos lo que tiene el mapa actualmente
      //borrarContenidoMapa();
      let entidadJSON = await response.json();
      entidadJSON=entidadJSON[0].geojson.features[0];     
      const capa = L.geoJSON(entidadJSON).addTo(map);
      map.fitBounds(capa.getBounds());
      //mostramos la barra inferior
      document.getElementById('bottomBar').classList.add('show');
      loadCardsCuts(cve_agee);
    }
  } catch (error) {
    console.error(error.message);    
  }  
}



function borrarContenidoMapa(){
      map.eachLayer(function(layer) {
        // Evita eliminar la capa base (como el mapa de fondo)
        if (!(layer instanceof L.TileLayer)) {
          map.removeLayer(layer);
        }
      });  
}
  </script>
</body>
</html>